
---
title: "Untitled"
author: "Ipsita Datta"
date: "9/28/2021"

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
 • explaining what you did in the project and any interesting findings
 • You should also reflect on the process you went through for this project. Discuss things like:
 – what was the most difficult part of the logic and programming for you?
 – what would you do differently in approaching a similar project in the future?
• In your blog post, provide a link to your github pages repo and the usual repo as well!

# Requirements 
 To use the functions for interacting with the API, I used the following packages:

- [`tidyverse`](https://www.tidyverse.org/): useful features for data manipulation and visualization
- [`jsonlite`](https://cran.r-project.org/web/packages/jsonlite/): API interaction
- [`httr`](https://cran.r-project.org/web/packages/httr/index.html): For using function to interact with API

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Load in the packages.
#install.packages("httr")

library(tidyverse)
library(jsonlite)
library(httr)
```
# API Interaction Functions
```{r}
outputAPI<-GET("https://api.covid19api.com/live/country/USA")
data<-fromJSON(rawToChar(outputAPI$content))
df<-as.data.frame(data)
```

## `convertToNumeric`

It is a helper function to convert columns that contain numeric data stored as `character` values to numeric data types. 

```{r}
convertToNumeric <- function(vec){
  ###
  # This function will convert the input vector to a numeric vector if it is 
  # able to. Otherwise, it just returns the vector.
  ###
  
  # If any of the values in vec return NA when trying to convert to numeric,
  # set output to the unchanged input.
  if (any(is.na(suppressWarnings(as.numeric(vec))) == TRUE)){
    output <- vec
  }
  # Otherwise, convert vec to a numeric vector.
  else {
    output <- as.numeric(vec)
  }
  # Return output.
  return(output)
}
```
# This function returns current cases for all the country along with globalcases and can also return for single country if name passed as argument.
```{r}
summary<-function(CountryName ="all"){
         outputAPI<-GET("https://api.covid19api.com/summary")
         data<-fromJSON(rawToChar(outputAPI$content))
         df<-as.data.frame(data)
         if ( CountryName != "all"){
         #if country name is in Countries.country
         if (CountryName %in% df$Countries.Country){
         # subset output for just that row.
         df<-filter(df,Countries.Country == CountryName)
         }
         # if country name is in countrycode
         else if (CountryName %in% df$Countries.CountryCode ){
          df<-filter(df,Countries.CountryCode == CountryName) 
         }
         # if country code in country slug
         else if (CountryName %in% df$Countries.Slug ){
          df<-filter(df,Countries.Slug == CountryName) 
         }
          else {
      message <- paste("ERROR: Argument for country was not found in either",
                       "the countryName or code columns. Try Countries('all') to",
                       "find the CountryName you're looking for.")
      stop(message)
          }
         }
          # Do nothing if the Country value equals "all".
  else {
    
  }
        # Return the output data.frame.
        return(df)
}

```
## `Countries`

I wrote this function to interact with the `Countries` endpoint of the Covid19 API.It returns all countries and associated provinces. 

```{r}
Country <- function(Ucountry){
    #Returns all the available countries and provinces, as well as the country slug for per country requests.
  outputAPI<-GET("https://api.covid19api.com/countries")
data<-fromJSON(rawToChar(outputAPI$content))
df<-as.data.frame(data)
  # If Province does not equal "all", check if it is a Province name.
  if (Ucountry %in% df$Country){
    # subset output for just that row.
    
      df<-filter(df,Country == Ucountry)
    
  }
  # Return the output data.frame.
  return(df)
}

```
# Returns all cases by case type for a country. Country must be the slug from /countries or /summary. Cases must be one of: confirmed, recovered, deaths
```{r}
  outputAPI<-GET("https://api.covid19api.com/country/south-africa")
data<-fromJSON(rawToChar(outputAPI$content))
df<-as.data.frame(data)

```
# wrrapper function

```{r}
CovidAPI <- function(func, ...){
  ###
  # This function is a wrapper for the other functions. It takes in the name
  # of the function to use as a character and any additional arguments for that
  # function.
  ###
  
  # Find and call the appropriate function using conditional logic.
  if (func == "summary"){
    df <- summary(...)
  }
  else if (func == "findCountryByCode"){
    df <- findCountryByCode(...)
  }
  else {
    stop("ERROR: Argument for func is not valid!")
  }
  
  # Return the output from the appropriate function.
  return(df)
}
```
# Data Exploration

Now that we can interact with a few of the endpoints of the Covid19 API, let's get some data from them.
First, let's pull A function returns current cases for all the country along with global cases
```{r}
# Get the current cases for all of the country .
currentData<- CovidAPI("summary")
```
Two variables of interest to me are shots per game and shooting percentage. I'm interested in how these two stats relate to a team's win percentage. This variable doesn't exist, so I need to calculate it. I define this as the number of wins divided by the total number of games played. 

```{r}
# Add a column for the death per 10000
currentData <- currentData %>%
  mutate(deathRate = round((Countries.TotalDeaths*10000 )/ Global.TotalDeaths),0)

# Create a Bar Plot of deathRate per Country( frist 10 country from the dataset).
head(currentData,10) %>% ggplot(aes(  Countries.Country,deathRate,
             fill=deathRate)) +
  geom_col() + 
  # Rotate the x-axis labls 90 degrees and remove the legend.
  theme(axis.text.x=element_text(angle=90), legend.position="none") +
  # Set the axes labels.
  scale_x_discrete("Country") + 
  scale_y_continuous("DeathRate") +
  # Add a title.
  ggtitle("First 10 country death rate from Current data") 

```